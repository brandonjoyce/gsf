---
import HeroContent from "./HeroContent.astro";

// Define the gallery images - can be easily updated later
const galleryImages = [
    {
        src: "/gallery/scholarships-2022.webp",
        alt: "GSF Scholarship recipients Spring 2022",
        title: "Scholarship Awards",
    },
    {
        src: "/gallery/academy-of-scholars.webp",
        alt: "Academy of Scholars student Ryan",
        title: "Academy of Scholars",
    },
    {
        src: "/gallery/preschool-grant.webp",
        alt: "GSF Preschool Grant recipient",
        title: "Academic Classroom Grants",
    },
    {
        src: "/gallery/book-club.webp",
        alt: "Greenwood Book Club students",
        title: "GSF Book Clubs",
    },
    {
        src: "/gallery/pbis-gold.webp",
        alt: "PBIS Gold Award for Greenwood staff",
        title: "PBIS Program",
    },
];
---

<section
    class="bg-gradient-to-br from-primary-500 to-secondary-800 text-white py-12 md:py-16 flex items-center"
>
    <div class="max-w-6xl mx-auto px-6 w-full">
        <div class="w-full">
            <!-- Mobile: Content above gallery, Desktop: Side by side -->
            <div class="flex flex-col lg:flex-row lg:items-center lg:gap-12">
                <!-- Hero Content -->
                <div class="lg:w-1/2 text-center lg:text-left mb-8 lg:mb-0">
                    <HeroContent />
                </div>

                <!-- Gallery Container -->
                <div class="lg:w-1/2">
                    <!-- Main Display Image -->
                    <div class="mb-6 md:mb-8 relative">
                        <div
                            class="relative overflow-hidden rounded-lg shadow-2xl bg-white/10 backdrop-blur-sm"
                        >
                            <img
                                id="main-gallery-image"
                                src={galleryImages[0].src}
                                alt={galleryImages[0].alt}
                                class="w-full h-64 md:h-80 lg:h-96 object-cover transition-all duration-500"
                            />
                            <div
                                class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"
                            >
                            </div>
                            <div class="absolute bottom-4 left-4 right-4">
                                <h3
                                    id="main-gallery-title"
                                    class="text-xl md:text-2xl font-bold text-white drop-shadow-lg"
                                >
                                    {galleryImages[0].title}
                                </h3>
                            </div>
                        </div>
                    </div>

                    <!-- Thumbnail Navigation -->
                    <div
                        class="flex justify-center lg:justify-start gap-2 md:gap-4 flex-wrap"
                    >
                        {
                            galleryImages.map((image, index) => (
                                <button
                                    class={`gallery-thumb relative overflow-hidden rounded-md transition-all duration-300 hover:scale-105 hover:shadow-lg ${index === 0 ? "active" : ""}`}
                                    data-index={index}
                                    data-src={image.src}
                                    data-alt={image.alt}
                                    data-title={image.title}
                                >
                                    <img
                                        src={image.src}
                                        alt={image.alt}
                                        class="w-16 h-16 md:w-20 md:h-20 object-cover"
                                    />
                                    <div class="absolute inset-0 bg-black/20 transition-opacity duration-300 opacity-0 hover:opacity-0" />
                                </button>
                            ))
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    .gallery-thumb.active {
        box-shadow: 0 0 0 2px rgb(255 255 255);
        transform: scale(1.05);
        opacity: 1;
    }

    .gallery-thumb:not(.active) {
        opacity: 0.7;
    }

    .gallery-thumb:not(.active):hover {
        opacity: 1;
    }

    #main-gallery-image {
        min-height: 16rem;
    }

    @media (min-width: 768px) {
        #main-gallery-image {
            min-height: 20rem;
        }
    }

    @media (min-width: 1024px) {
        #main-gallery-image {
            min-height: 24rem;
        }
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const mainImage = document.getElementById("main-gallery-image") as HTMLImageElement;
        const mainTitle = document.getElementById("main-gallery-title");
        const thumbnails = document.querySelectorAll(".gallery-thumb");

        if (mainImage && mainTitle && thumbnails.length > 0) {
            let currentIndex = 0;
            let autoRotateInterval = 0;
            let restartTimeout = 0;

            function updateGallery(index) {
                const thumb = thumbnails[index];
                const src = thumb.getAttribute("data-src");
                const alt = thumb.getAttribute("data-alt");
                const title = thumb.getAttribute("data-title");

                mainImage.style.opacity = "0";
                setTimeout(function() {
                    mainImage.src = src || "";
                    mainImage.alt = alt || "";
                    mainTitle.textContent = title;
                    mainImage.style.opacity = "1";
                }, 250);

                thumbnails.forEach(function(t) { t.classList.remove("active"); });
                thumb.classList.add("active");
                currentIndex = index;
            }

            function startAutoRotate() {
                stopAutoRotate();
                autoRotateInterval = window.setInterval(function() {
                    const nextIndex = (currentIndex + 1) % thumbnails.length;
                    updateGallery(nextIndex);
                }, 5000);
            }

            function stopAutoRotate() {
                if (autoRotateInterval) {
                    window.clearInterval(autoRotateInterval);
                    autoRotateInterval = 0;
                }
                if (restartTimeout) {
                    window.clearTimeout(restartTimeout);
                    restartTimeout = 0;
                }
            }

            thumbnails.forEach(function(thumb, index) {
                thumb.addEventListener("click", function () {
                    stopAutoRotate();
                    updateGallery(index);

                    // Restart auto-rotation after 10 seconds of no interaction
                    restartTimeout = window.setTimeout(function() {
                        startAutoRotate();
                    }, 10000);
                });
            });

            // Start auto-rotate on load
            startAutoRotate();
        }
    });
</script>
